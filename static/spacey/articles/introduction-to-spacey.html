<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to `spacey` • spacey</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to `spacey`">
<meta property="og:description" content="spacey">
<meta property="og:image" content="https://mikemahoney218.github.io/spacey/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-127971769-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-127971769-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spacey</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"></ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction-to-spacey.html">Introduction to spacey</a>
    </li>
    <li>
      <a href="../articles/automap-walkthrough.html">automap reference</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://github.com/mikemahoney218/spacey">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to <code>spacey</code>
</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mikemahoney218/spacey/blob/master/vignettes/introduction-to-spacey.Rmd"><code>vignettes/introduction-to-spacey.Rmd</code></a></small>
      <div class="hidden name"><code>introduction-to-spacey.Rmd</code></div>

    </div>

    
    
<p><code>spacey</code> is a package designed to make it trivial to produce beautiful <a href="https://www.rayshader.com/">rayshader</a> maps for locations in the United States, letting you easily obtain and combine USGS and ESRI map data into 2D and 3D images. This vignette will walk through the basic utilities in <code>spacey</code> and their expected uses.</p>
<p>First, let’s load our package:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">spacey</span>)</pre></body></html></div>
<p>The most comprehensive command in <code>spacey</code> is <code>automap</code>, which only requires two vectors, one for latitude and one for longitude<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>, in order to quickly generate a rayshader image. In fact, you can use as little as a single coordinate pair:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">example_map</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/automap.html">automap</a></span>(<span class="fl">44.121268</span>, -<span class="fl">73.903734</span>)
<span class="no">example_map</span></pre></body></html></div>
<p><img src="../man/figures/README-johns_brook_basic-1.png" width="336"></p>
<p>And it isn’t much harder to add overlays of satellite imagery:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">example_map</span>$<span class="fu">update_values</span>(<span class="kw">overlay</span> <span class="kw">=</span> <span class="st">"World_Imagery"</span>)
<span class="no">example_map</span></pre></body></html></div>
<p><img src="../man/figures/README-johns_brook_overlay-1.png" width="336"></p>
<p>Or turn those into 3D visuals:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">example_map</span>$<span class="fu">update_values</span>(<span class="kw">method</span> <span class="kw">=</span> <span class="st">"3d"</span>)
<span class="no">example_map</span></pre></body></html></div>
<p><img src="../man/figures/README-johns_brook_3d-1.png" width="336"></p>
<p>In addition, <code>automap</code> supports parallelization with <code>future</code> straight out of the box to speed up map generation – just call <code><a href="https://rdrr.io/pkg/future/man/plan.html">future::plan("multisession")</a></code> (or whatever plan you prefer) before <code>automap</code> to run the different rayshading processes in parallel, notably speeding up the whole map generation process.</p>
<p>All of the elevation and imagery data pulled by this package comes via the <a href="https://www.usgs.gov/core-science-systems/national-geospatial-program/national-map">USGS National Map API</a>, with the satellite imagery in particular coming via <a href="https://services.arcgisonline.com/ArcGIS/rest/services">ESRI’s MapServer API</a>. If you want to save these off as files (so that you can work on your maps without an Internet connection, or archive the data used), use the <code><a href="../reference/get_heightmap.html">get_heightmap()</a></code> and <code><a href="../reference/get_image_overlay.html">get_image_overlay()</a></code> functions:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">bounding_box</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_centroid_bounding_box.html">get_centroid_bounding_box</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">lat</span> <span class="kw">=</span> <span class="fl">44.121268</span>, <span class="kw">lng</span> <span class="kw">=</span> -<span class="fl">73.903734</span>),
                                          <span class="kw">distance</span> <span class="kw">=</span> <span class="fl">10</span>)
<span class="no">heightmap</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_heightmap.html">get_heightmap</a></span>(<span class="no">bounding_box</span>,
                           <span class="kw">save.tif</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                           <span class="kw">tif.filename</span> <span class="kw">=</span> <span class="st">"out.tif"</span>)
<span class="no">overlay</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_image_overlay.html">get_image_overlay</a></span>(<span class="no">bounding_box</span>,
                             <span class="kw">save.png</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                             <span class="kw">png.filename</span> <span class="kw">=</span> <span class="st">"out.png"</span>)</pre></body></html></div>
<p>You can then use <code>load_heightmap</code> and <code>load_overlay</code> functions to load those files into your session, and then provide the arrays to the <code>heightmap</code> and <code>texture</code> arguments of <code>automap</code>.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">saved_map</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/automap.html">automap</a></span>(<span class="kw">heightmap</span> <span class="kw">=</span> <span class="no">heightmap</span>,
                     <span class="kw">texture</span> <span class="kw">=</span> <span class="no">overlay</span>)</pre></body></html></div>
<p>The <code>automap</code> function can be customized in dozens of ways to quickly iterate on maps, changing the specified overlays, terrain heights, color shading, and more. To tweak individual values used in calculating your map, use the <code>update_values()</code> function attached to your map objects to only refresh components which will change as a result:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="kw pkg">tictoc</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html">tic</a></span>()
<span class="no">example_map</span>$<span class="fu">update_values</span>(<span class="kw">overlay</span> <span class="kw">=</span> <span class="st">"USA_Topo_Maps"</span>)
<span class="no">example_map</span>
<span class="kw pkg">tictoc</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html">toc</a></span>()
<span class="co">#&gt; 8.821 sec elapsed</span></pre></body></html></div>
<p><img src="topo.png" width="350"></p>
<p>If you only want to access the USGS and ESRI APIs, there’s no need to use the <code>automap</code> function at all. Instead, you can use the <code>get_heightmap</code> and <code>get_image_overlay</code> functions to accomplish a similar effect.</p>
<p>The largest difference with these functions (other than their return objects) is that they expect a <em>bounding box</em> for your map, while <code>automap</code> will calculate one for you based on the spatial extent of your input data and any value you pass to its <code>distance</code> argument. The bounding box needs to be a list containing coordinates for the lower left and upper right corners of your data (as two separate list elements) – you can either provide these yourself, or use one of the two functions provided by <code>spacey</code> to do it for you!</p>
<p>The first of these functions is <code>get_centroid_bounding_box</code>, which is what <code>automap</code> uses to find the bounding box for a single coordinate pair. Just provide a named vector with latitude and longitude for the center of your map, alongside the distance you want your map to span (from the central location to any corner):</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="../reference/get_centroid_bounding_box.html">get_centroid_bounding_box</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(
  <span class="st">"lat"</span> <span class="kw">=</span> <span class="fl">44.121268</span>,
  <span class="st">"lng"</span> <span class="kw">=</span> -<span class="fl">73.903734</span>
),
<span class="kw">distance</span> <span class="kw">=</span> <span class="fl">10</span>
)
<span class="co">#&gt; $bl</span>
<span class="co">#&gt;       lat       lng </span>
<span class="co">#&gt;  44.05771 -73.99212 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $tr</span>
<span class="co">#&gt;       lat       lng </span>
<span class="co">#&gt;  44.18475 -73.81515</span></pre></body></html></div>
<p>If you have more than just a single coordinate pair, you’re still able to get a bounding box for your data via <code>get_coord_bounding_box</code> – just pass it vectors containing your latitude and longitude data:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  <span class="kw">lat</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">44.05771</span>, <span class="fl">44.18475</span>),
  <span class="kw">lng</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">73.99212</span>, -<span class="fl">73.81515</span>)
)

<span class="fu"><a href="../reference/get_coord_bounding_box.html">get_coord_bounding_box</a></span>(<span class="no">df</span>$<span class="no">lat</span>, <span class="no">df</span>$<span class="no">lng</span>)
<span class="co">#&gt; $bl</span>
<span class="co">#&gt;       lat       lng </span>
<span class="co">#&gt;  44.05771 -73.99212 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $tr</span>
<span class="co">#&gt;       lat       lng </span>
<span class="co">#&gt;  44.18475 -73.81515</span></pre></body></html></div>
<p>You can also still take advantage of expanding the map to a certain distance from your data’s central point by finding the centroid for your dataset – using <code>get_centroid</code> – and then passing that as the first argument to <code>get_centroid_bounding_box</code>:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="../reference/get_centroid.html">get_centroid</a></span>(<span class="no">df</span>$<span class="no">lat</span>, <span class="no">df</span>$<span class="no">lng</span>)
<span class="co">#&gt;       lat       lng </span>
<span class="co">#&gt;  44.12126 -73.90373</span>

<span class="fu"><a href="../reference/get_centroid_bounding_box.html">get_centroid_bounding_box</a></span>(<span class="fu"><a href="../reference/get_centroid.html">get_centroid</a></span>(<span class="no">df</span>$<span class="no">lat</span>, <span class="no">df</span>$<span class="no">lng</span>), <span class="fl">10</span>)
<span class="co">#&gt; $bl</span>
<span class="co">#&gt;       lat       lng </span>
<span class="co">#&gt;  44.05771 -73.99212 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $tr</span>
<span class="co">#&gt;       lat       lng </span>
<span class="co">#&gt;  44.18475 -73.81515</span></pre></body></html></div>
<p>All of these functions also have the option to work with (and return) data in radians by setting <code>coord.unit = "radians"</code>; the default, however, is decimal degrees. Functions which take <code>distance</code> arguments also have a <code>dist.unit</code> argument, which can be used to provide distances in <code>"km"</code> (the default), <code>"miles", "m"</code> (for meters), or <code>"ft"</code>. Note that the conversions between these units are imperfect, so use <code>km</code> if precision is needed.</p>
<p>No matter which method you use, that bounding box can then be passed to <code>get_heightmap</code> to obtain USGS elevation data for your area of interest, or <code>get_image_overlay</code> to obtain satellite images:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">bbox</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_centroid_bounding_box.html">get_centroid_bounding_box</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"lat"</span> <span class="kw">=</span> <span class="fl">44.121268</span>,
                                 <span class="st">"lng"</span> <span class="kw">=</span> -<span class="fl">73.903734</span>),
                                <span class="kw">distance</span> <span class="kw">=</span> <span class="fl">10</span>)

<span class="no">heightmap</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_heightmap.html">get_heightmap</a></span>(<span class="no">bbox</span>)</pre></body></html></div>
<p>Both of these functions also provide options to save the downloaded imagery to file – either using <code>save.tif</code> in <code>get_heightmap</code> or <code>save.png</code> in <code>get_image_overlay</code>. You can then load these images back into an R session using the <code>load_heightmap</code> or <code>load_overlay</code> functions, respectively, which will create objects ready to be used for mapping with rayshader.</p>
<p>My guess is that most people who use <code>spacey</code> will eventually move on to carefully designing their output maps, since you’re able to control things with much more granularity using the core <code>rayshader</code> functions than you are with <code>spacey</code>. However, the data import functions and quick iteration provided by <code>spacey</code> will hopefully help you get started with making these beautiful maps, letting you spend less time fighting with data and more time communicating your landscape to your audience.</p>
<div id="miscellania" class="section level2">
<h2 class="hasAnchor">
<a href="#miscellania" class="anchor"></a>Miscellania</h2>
<p>In addition to these main functions, <code>spacey</code> implements basic functions for converting radians to degrees (via the function <code>rad_to_deg</code>) and back again (via <code>deg_to_rad</code>), which may be of some use. Note that these conversions are done simply and will incur some error from floating point arithmetic.</p>
<p>It should be noted that <code>spacey</code> really isn’t a geospatial processing library, and these commands are built to be exactly as accurate as needed by core package functions. For that reason, you probably shouldn’t rely upon <code>get_centroid</code> or <code>get_*_bounding_box</code> for points near extreme latitudes or longitudes, as there are no adjustments built in to deal with these locations, since the USGS data <code>spacey</code> is designed to work with doesn’t really wrap those.</p>
</div>
<div id="acknowledgements" class="section level2">
<h2 class="hasAnchor">
<a href="#acknowledgements" class="anchor"></a>Acknowledgements</h2>
<p><code>rayshader</code>, which powers the maps coming out of <code>automap</code>, was built by <a href="https://www.tylermw.com/">Tyler Morgan-Wall</a>, and can be extended <em>far</em> beyond what I’ve done here – check out <a href="https://www.rayshader.com/">its main website.</a></p>
<p>The USGS and ESRI query code has its roots in <a href="https://wcmbishop.github.io/rayshader-demo/">Will Bishop’s fantastic essay</a> on using <code>rayshader</code>.</p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>This package follows <a href="https://en.wikipedia.org/wiki/ISO_6709">ISO 6709</a> convention of representing spatial data in the format (latitude, longitude), as opposed to the somewhat popular (longitude, latitude) format.<a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Michael Mahoney.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
